<div class="flex h-full flex-col gap-4">
  <section
    uiContainerDiv
    class="flex-1 overflow-y-hidden"
    label=""
    [class.no-tasks-background]="!isLoading() && !hasVisibleEntries()"
  >
    <div class="flex h-full flex-col gap-4 p-4">
      <div class="flex items-center gap-3 text-sm font-semibold text-slate-100">
        <label class="flex items-center gap-2" for="task-tag-filter">
          <span class="whitespace-nowrap">Tag:</span>
        </label>
        <input
          uiInput
          id="task-tag-filter"
          type="text"
          placeholder="Type a tag"
          [formControl]="tagControl"
          [attr.list]="tagOptions().length > 0 ? 'task-tag-options' : null"
          style="width: 14rem"
        />
        <span class="text-slate-400" aria-hidden="true">|</span>
        <label class="flex items-center gap-2" for="task-priority-filter">
          <span class="whitespace-nowrap">Priority:</span>
        </label>
        <select
          uiInput
          id="task-priority-filter"
          [formControl]="priorityControl"
          style="width: 10rem"
        >
          @for (option of priorityOptions; track option.value) {
            <option [value]="option.value">{{ option.label }}</option>
          }
        </select>
      </div>
      @if (tagOptions().length > 0) {
        <datalist id="task-tag-options">
          @for (tag of tagOptions(); track tag) {
            <option [value]="tag"></option>
          }
        </datalist>
      }
      @if (isLoading()) {
        <p class="text-sm text-slate-400" aria-live="polite">Loading entriesâ€¦</p>
      } @else if (!hasVisibleEntries()) {
        <p class="text-sm text-slate-400">No entries yet.</p>
      } @else {
        <div
          class="grid h-full grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5"
          cdkDropListGroup
        >
          @for (column of columns(); track trackColumn($index, column)) {
            <section
              class="tasks-column relative flex h-full min-h-0 flex-col"
              [attr.aria-label]="column.label"
              [class.tasks-column-todo]="column.key === 'TODO'"
              [class.tasks-column-doing]="column.key === 'DOING'"
              [class.tasks-column-later]="column.key === 'LATER'"
              [class.tasks-column-done]="column.key === 'DONE'"
              [class.tasks-column-cancelled]="column.key === 'CANCELLED'"
            >
              <img
                role="heading"
                aria-level="2"
                ngSrc="{{ column.imageSrc }}"
                width="700"
                height="200"
                [attr.alt]="column.label"
                class="absolute top-3 left-1/2 z-2 h-15 max-h-15 w-auto -translate-x-1/2 transform"
              />
              <div
                #dropList
                cdkDropList
                [id]="column.id"
                [cdkDropListData]="column.entries"
                [cdkDropListConnectedTo]="dropListIds()"
                class="tasks-drop-list flex min-h-24 flex-1 flex-col gap-2 px-1 pt-19"
                (cdkDropListDropped)="drop($event, column.key)"
                (scroll)="updateScrollState(dropList)"
              >
                @for (entry of column.entries; track trackEntry($index, entry)) {
                  <div cdkDrag [cdkDragData]="entry">
                    <button
                      type="button"
                      class="w-full text-left"
                      (click)="openEntry(entry); entryDialog.open()"
                    >
                      <app-task-card [entry]="entry" />
                    </button>
                  </div>
                }
              </div>
            </section>
          }
        </div>
      }
    </div>
  </section>
</div>
<app-dialog
  #entryDialog
  [labelledById]="'kanban-entry-title'"
  [describedById]="'kanban-entry-body'"
  (closed)="closeEntry()"
  (cancelled)="closeEntry()"
>
  @if (selectedEntry(); as entry) {
    <div class="flex items-start justify-between gap-4 px-5 pt-5">
      <div>
        <h2 class="text-lg font-semibold text-slate-100" id="kanban-entry-title">
          {{ entry.title || 'Task' }}
        </h2>
        <p class="text-sm text-slate-400" id="kanban-entry-body">View and edit task details.</p>
      </div>
      <app-icon-button-danger icon="x" label="Close dialog" (pressed)="entryDialog.close()" />
    </div>
    <div class="px-5 pb-5">
      <app-journal-entry [entry]="entry" (deleted)="handleEntryDeleted($event)" />
    </div>
  }
</app-dialog>
