<div class="flex h-full flex-col gap-4">
  <section uiContainerDiv class="flex-1 overflow-y-hidden" label="">
    <div class="flex h-full flex-col gap-4 p-4">
      <div class="flex flex-col gap-2">
        <label class="text-sm font-semibold text-slate-100" for="task-tag-filter">
          Filter by tag
        </label>
        <input
          uiInput
          id="task-tag-filter"
          type="text"
          placeholder="Type a tag to filter"
          [formControl]="tagControl"
          [attr.list]="tagOptions().length > 0 ? 'task-tag-options' : null"
        />
        @if (tagOptions().length > 0) {
          <datalist id="task-tag-options">
            @for (tag of tagOptions(); track tag) {
              <option [value]="tag"></option>
            }
          </datalist>
        }
      </div>
      @if (isLoading()) {
        <p class="text-sm text-slate-400" aria-live="polite">Loading entriesâ€¦</p>
      } @else if (!hasVisibleEntries()) {
        <p class="text-sm text-slate-400">No entries yet.</p>
      } @else {
        <div
          class="grid h-full grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5"
          cdkDropListGroup
        >
          @for (column of columns(); track trackColumn($index, column)) {
            <section
              class="flex h-full min-h-0 flex-col gap-3 overflow-y-auto"
              [attr.aria-label]="column.label"
            >
              <header class="flex items-center justify-between">
                <h2 class="text-xs font-semibold tracking-[0.18em] text-slate-400 uppercase">
                  {{ column.label }}
                </h2>
                <span
                  class="rounded-full border border-white/10 bg-white/5 px-2 py-0.5 text-[10px] font-semibold tracking-[0.12em] text-slate-300 uppercase"
                >
                  {{ column.entries.length }}
                </span>
              </header>
              <div
                cdkDropList
                [id]="column.id"
                [cdkDropListData]="column.entries"
                [cdkDropListConnectedTo]="dropListIds()"
                class="flex min-h-24 flex-1 flex-col gap-2 rounded-lg border border-white/10 bg-black/40 p-2"
                (cdkDropListDropped)="drop($event, column.key)"
              >
                @if (column.entries.length === 0) {
                  <p class="text-xs text-slate-500">No tasks.</p>
                } @else {
                  @for (entry of column.entries; track trackEntry($index, entry)) {
                    <div cdkDrag [cdkDragData]="entry">
                      <button
                        type="button"
                        class="w-full text-left"
                        (click)="openEntry(entry); entryDialog.open()"
                      >
                        <app-task-card [entry]="entry" />
                      </button>
                    </div>
                  }
                }
              </div>
            </section>
          }
        </div>
      }
    </div>
  </section>
</div>
<app-dialog
  #entryDialog
  [labelledById]="'kanban-entry-title'"
  [describedById]="'kanban-entry-body'"
  (closed)="closeEntry()"
  (cancelled)="closeEntry()"
>
  @if (selectedEntry(); as entry) {
    <div class="flex items-start justify-between gap-4 px-5 pt-5">
      <div>
        <h2 class="text-lg font-semibold text-slate-100" id="kanban-entry-title">
          {{ entry.title || 'Task' }}
        </h2>
        <p class="text-sm text-slate-400" id="kanban-entry-body">
          View and edit task details.
        </p>
      </div>
      <app-icon-button-danger icon="x" label="Close dialog" (pressed)="entryDialog.close()" />
    </div>
    <div class="px-5 pb-5">
      <app-journal-entry [entry]="entry" (deleted)="handleEntryDeleted($event)" />
    </div>
  }
</app-dialog>
