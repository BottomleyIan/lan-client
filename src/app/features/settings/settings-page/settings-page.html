<app-panel label="Settings">
  <div class="flex flex-col gap-4 px-5 py-4">
    <div class="flex items-center justify-between gap-3">
      <h2 class="text-xl font-semibold text-slate-100">Music Folders</h2>
      @if (folders$ | async; as folders) {
        <span class="text-xs font-semibold tracking-[0.12em] text-slate-400 uppercase">
          {{ folders.length }} folders
        </span>
      }
    </div>

    <form uiForm (ngSubmit)="addFolder()" [formGroup]="createForm">
      <div class="flex flex-col gap-2">
        <label class="text-sm font-semibold text-slate-100" for="folder-path">Add folder</label>
        <p class="text-xs text-slate-400">Enter a music folder path to include in the library.</p>
        <div class="flex flex-col gap-2 @sm:flex-row @sm:items-center">
          <input
            uiInput
            id="folder-path"
            name="folder-path"
            type="text"
            placeholder="/Users/you/Music"
            formControlName="path"
            [attr.aria-invalid]="pathControl.invalid && pathControl.touched ? true : null"
            [disabled]="isCreating()"
          />
          <div class="flex flex-col gap-2 @sm:flex-row @sm:items-center">
            <button uiConfirmButton type="submit" [disabled]="createForm.invalid || isCreating()">
              Add folder
            </button>
            <button
              uiCancelButton
              type="button"
              [disabled]="isCreating() || !pathControl.value"
              (click)="resetForm()"
            >
              Clear
            </button>
          </div>
        </div>
        @if (pathControl.invalid && pathControl.touched) {
          <p class="text-xs font-semibold text-rose-200">Folder path is required.</p>
        }
      </div>
    </form>

    @if (folders$ | async; as folders) {
      @if (folders.length === 0) {
        <p class="text-sm text-slate-300">No folders added yet.</p>
      } @else {
        <div class="overflow-hidden rounded-xl border border-white/10 bg-white/5">
          <table uiTable aria-label="Music folders">
            <thead uiTHead>
              <tr>
                <th scope="col" class="px-4 py-3 font-semibold">Path</th>
                <th scope="col" class="px-4 py-3 font-semibold">Availability</th>
                <th scope="col" class="px-4 py-3 font-semibold">Last Scan</th>
                <th scope="col" class="px-4 py-3 text-right font-semibold">Actions</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-white/10">
              @for (folder of folders; track folder.id) {
                <tr class="transition-colors hover:bg-white/5">
                  <td class="px-4 py-3 font-medium text-slate-100">{{ folder.path }}</td>
                  <td class="px-4 py-3 text-slate-300">{{ folder.availability }}</td>
                  <td class="px-4 py-3 text-slate-300">
                    <div class="flex flex-col leading-tight">
                      <span>
                        @if (isScanning(folder.id)) {
                          <span class="text-amber-200">Scanning…</span>
                        } @else {
                          {{ folder.lastScanStatus }}
                        }
                      </span>
                      <span class="text-xs text-slate-500">{{ folder.lastScanAt }}</span>
                    </div>
                  </td>
                  <td class="px-4 py-3 text-right text-slate-500">
                    <div class="flex justify-end gap-2">
                      <app-icon-button
                        icon="refresh"
                        [label]="'Scan folder ' + folder.path"
                        [disabled]="folder.folderId === null || isScanning(folder.id)"
                        (pressed)="scanFolder(folder)"
                      />
                      <app-icon-button
                        icon="trash"
                        [label]="'Delete folder ' + folder.path"
                        [disabled]="folder.folderId === null || isDeleting(folder.id)"
                        (pressed)="deleteFolder(folder)"
                      />
                    </div>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      }
    } @else {
      <p class="text-sm text-slate-400" aria-live="polite">Loading folders…</p>
    }
  </div>
</app-panel>
