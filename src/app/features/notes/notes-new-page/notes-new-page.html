<div class="flex h-full flex-col gap-4 overflow-hidden">
  <app-panel class="flex-1" label="" [stableGutter]="false">
    <div class="p-4">
      <form uiForm [formGroup]="form" (ngSubmit)="submit()">
        <div class="flex flex-col gap-1">
          <h2 class="text-lg font-semibold text-slate-100">New journal</h2>
          <p class="text-sm text-slate-400">Log a journal entry for today.</p>
        </div>

        <div class="mt-2 flex flex-col gap-2">
          <label class="text-sm font-semibold text-slate-100" for="journal-body">Body</label>
          <textarea
            uiInput
            id="journal-body"
            rows="6"
            placeholder="Write your note..."
            formControlName="body"
            [attr.aria-invalid]="body.invalid && body.touched ? true : null"
            [disabled]="isSaving()"
          ></textarea>
          @if (body.invalid && body.touched) {
            <p class="text-xs font-semibold text-rose-200">Body is required.</p>
          }
        </div>

        <div class="mt-4 flex flex-col gap-2">
          <label class="text-sm font-semibold text-slate-100" for="journal-description">
            Description
          </label>
          <input
            uiInput
            id="journal-description"
            type="text"
            placeholder="Optional summary"
            formControlName="description"
            [disabled]="isSaving()"
          />
        </div>

        <div class="mt-4 flex flex-col gap-2">
          <label class="text-sm font-semibold text-slate-100" for="journal-tags">Tags</label>
          <input
            uiInput
            id="journal-tags"
            type="text"
            placeholder="daily, release, ideas"
            formControlName="tags"
            [disabled]="isSaving()"
          />
          <p class="text-xs text-slate-400">Separate tags with commas.</p>
        </div>

        <details
          class="mt-4 rounded-lg border border-white/10 bg-white/5 p-3"
          (toggle)="handleEntryToggle($event)"
        >
          <summary class="cursor-pointer text-sm font-semibold text-slate-100">
            Entry fields
          </summary>
          <fieldset class="mt-3 flex flex-col gap-3">
            <legend class="sr-only">Entry fields</legend>
            <div class="flex flex-col gap-2">
              <label class="text-sm font-semibold text-slate-100" for="task-status">Status</label>
              <select uiInput id="task-status" formControlName="status" [disabled]="isSaving()">
                <option value="">No entry status</option>
                @for (status of entryStatuses; track status) {
                  <option [value]="status">{{ status }}</option>
                }
              </select>
            </div>

            <div class="flex flex-col gap-2">
              <label class="text-sm font-semibold text-slate-100" for="task-scheduled-date">
                Due date
              </label>
              <div class="grid grid-cols-1 gap-2 sm:grid-cols-[1fr_auto]">
                <input
                  uiInput
                  id="task-scheduled-date"
                  type="date"
                  formControlName="scheduledDate"
                  [disabled]="isSaving()"
                />
                <input
                  uiInput
                  id="task-scheduled-time"
                  type="time"
                  formControlName="scheduledTime"
                  aria-label="Due time"
                  [disabled]="isSaving()"
                />
              </div>
            </div>

            <div class="flex flex-col gap-2">
              <label class="text-sm font-semibold text-slate-100" for="task-deadline-date">
                Deadline
              </label>
              <div class="grid grid-cols-1 gap-2 sm:grid-cols-[1fr_auto]">
                <input
                  uiInput
                  id="task-deadline-date"
                  type="date"
                  formControlName="deadlineDate"
                  [disabled]="isSaving()"
                />
                <input
                  uiInput
                  id="task-deadline-time"
                  type="time"
                  formControlName="deadlineTime"
                  aria-label="Deadline time"
                  [disabled]="isSaving()"
                />
              </div>
            </div>
          </fieldset>
        </details>

        <div class="mt-6 flex justify-end gap-2">
          <app-icon-button-danger
            icon="x"
            label="Cancel"
            [disabled]="isSaving()"
            (pressed)="cancel()"
          />
          <app-icon-button-primary
            icon="check"
            label="Save journal"
            [disabled]="form.invalid || isSaving()"
            type="submit"
          />
        </div>
      </form>
    </div>
  </app-panel>
</div>
