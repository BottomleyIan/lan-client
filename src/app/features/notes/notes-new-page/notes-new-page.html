<div class="flex h-full flex-col gap-4 overflow-hidden">
  <app-panel class="flex-1 overflow-hidden" label="" [stableGutter]="false">
    <div class="flex flex-col overflow-y-auto">
      <div class="p-4">
        <form uiForm [formGroup]="form" (ngSubmit)="submit()">
          <div class="mt-4 flex flex-col gap-2">
            <div class="flex flex-row items-end gap-3">
              <label class="text-sm font-semibold text-slate-100" for="journal-tags">Tags</label>
              <p class="text-xs text-slate-400">Separate tags with commas.</p>
            </div>
            <input
              uiInput
              id="journal-tags"
              type="text"
              placeholder="daily, release, ideas"
              formControlName="tags"
              [disabled]="isSaving()"
            />
          </div>
          <div class="mt-4 flex flex-col gap-2">
            <label class="text-sm font-semibold text-slate-100" for="journal-description">
              Description
            </label>
            <input
              uiInput
              id="journal-description"
              type="text"
              placeholder="Optional summary"
              formControlName="description"
              [disabled]="isSaving()"
            />
          </div>
          <div class="mt-2 flex flex-col gap-2">
            <div class="flex flex-row items-end gap-3">
              <label class="text-sm font-semibold text-slate-100" for="journal-body">Body</label>
              @if (body.invalid && body.touched) {
                <p class="text-xs font-semibold text-rose-200">Body is required.</p>
              }
            </div>
            <textarea
              uiInput
              id="journal-body"
              rows="6"
              placeholder="Write your note..."
              formControlName="body"
              [attr.aria-invalid]="body.invalid && body.touched ? true : null"
              [disabled]="isSaving()"
            ></textarea>
          </div>

          @if (fieldKeys().length > 0) {
            <div class="grid grid-cols-[auto_1fr] items-center gap-3">
              @for (field of fieldKeys(); track field; let index = $index) {
                <app-notes-new-page-field
                  [field]="field"
                  [config]="fieldConfig(field)"
                  [control]="fieldControl(index)"
                  [disabled]="isSaving()"
                />
              }
            </div>
          }

          <details
            class="mt-4 rounded-lg border border-white/10 bg-white/5 p-3"
            (toggle)="handleEntryToggle($event)"
          >
            <summary class="cursor-pointer text-sm font-semibold text-slate-100">
              Task fields
            </summary>
            <fieldset class="mt-3 flex flex-col gap-3">
              <legend class="sr-only">Task</legend>
              <div class="flex flex-col gap-2">
                <label class="text-sm font-semibold text-slate-100" for="task-status">Status</label>
                <select uiInput id="task-status" formControlName="status" [disabled]="isSaving()">
                  <option value="">No entry status</option>
                  @for (status of entryStatuses; track status) {
                    <option [value]="status">{{ status }}</option>
                  }
                </select>
              </div>

              <div class="flex flex-col gap-2">
                <label class="text-sm font-semibold text-slate-100" for="task-priority"
                  >Priority</label
                >
                <select
                  uiInput
                  id="task-priority"
                  formControlName="priority"
                  [disabled]="isSaving()"
                >
                  <option value="">No priority</option>
                  @for (priority of ['low', 'medium', 'high']; track priority) {
                    <option [value]="priority">{{ priority }}</option>
                  }
                </select>
              </div>

              <div class="flex flex-col gap-2">
                <label class="text-sm font-semibold text-slate-100" for="task-scheduled-date">
                  Due date
                </label>
                <div class="grid grid-cols-1 gap-2 sm:grid-cols-[1fr_auto]">
                  <input
                    uiInput
                    id="task-scheduled-date"
                    type="date"
                    formControlName="scheduledDate"
                    [disabled]="isSaving()"
                  />
                  <input
                    uiInput
                    id="task-scheduled-time"
                    type="time"
                    formControlName="scheduledTime"
                    aria-label="Due time"
                    [disabled]="isSaving()"
                  />
                </div>
              </div>

              <div class="flex flex-col gap-2">
                <label class="text-sm font-semibold text-slate-100" for="task-deadline-date">
                  Deadline
                </label>
                <div class="grid grid-cols-1 gap-2 sm:grid-cols-[1fr_auto]">
                  <input
                    uiInput
                    id="task-deadline-date"
                    type="date"
                    formControlName="deadlineDate"
                    [disabled]="isSaving()"
                  />
                  <input
                    uiInput
                    id="task-deadline-time"
                    type="time"
                    formControlName="deadlineTime"
                    aria-label="Deadline time"
                    [disabled]="isSaving()"
                  />
                </div>
              </div>
            </fieldset>
          </details>

          <div class="mt-6 flex justify-end gap-2">
            <app-icon-button-danger
              icon="x"
              label="Cancel"
              [disabled]="isSaving()"
              (pressed)="cancel()"
            />
            <app-icon-button-primary
              icon="check"
              label="Save journal"
              [disabled]="form.invalid || isSaving()"
              type="submit"
            />
          </div>
        </form>
      </div>
    </div>
  </app-panel>
</div>
